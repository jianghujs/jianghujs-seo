{% extends 'index.html'%}

{% block vue_template %}

<!-- 3 table 下 article 的单表 crud 页面 -->


<v-container class="fullScreen d-flex flex-column pa-xs-0 pa-0">
  <v-card v-for="(category, index) in categoryList" :key="index" class="mx-auto" max-width="344" outlined>
    <v-list-item three-line>
      <v-list-item-content>
        <div class="text-overline mb-4">
          {{category.categoryName}} {{category.count}}
        </div>
        <v-list-item-title class="text-h5 mb-1">
          分类描述
        </v-list-item-title>
        
        <div v-for="(article, articleIndex) in category.articleList" :key="articleIndex">
          <a :href="'/xuanfeng_admin/page/article/' + article.articleId">{{article.articleTitle}}</a>
        </div>
      </v-list-item-content>
    </v-list-item>
  </v-card>

</v-container>

{% endblock %}
{% block vue_body %}

<script type="module">
  new Vue({
    el: '#app',
    template: '#app-template',
    vuetify: new Vuetify(),
    data: () => ({
      categoryList: [],
    }),
    computed: {
      isMobile() {
        return window.innerWidth < 600;
      },
    },
    watch: {},
    async created() {
      this.getCategoryList();
    },
    mounted() {},
    methods: {
      async getCategoryList() {
        const { data: { appData: { rows } } } = await window.jianghuAxios({
          data: {
            appData: {
              pageId: 'home',
              actionId: 'selectCategoryList',
              orderBy: [{ column: 'categoryGroup', order: 'asc' }, { column: 'categoryGroupSort', order: 'asc' }]
            },
          }
        });
        rows.forEach(row => {
          const articleIdList = row.articleIdList ? row.articleIdList.split(',') : [];
          const articleTitleList = row.articleIdList ? row.articleTitleList.split(',') : [];
          const articleList = [];
          for (let i = 0; i < articleIdList.length; i++) {
            articleList.push({
              articleId: articleIdList[i],
              articleTitle: articleTitleList[i],
            })
          }
          row.articleList = articleList.slice(0,3);
        })
        this.categoryList = rows;
      },
    }
  })
</script>

<style scoped>
</style>
{% endblock %}